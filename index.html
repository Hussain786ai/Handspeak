<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">
<title>HANDSPEAK</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0a0f;
    --surface: #111118;
    --border: #1e1e2e;
    --accent: #00ff88;
    --accent2: #ff3366;
    --text: #e8e8f0;
    --muted: #555570;
  }
  * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
  html,body { width:100%; height:100%; background:var(--bg); color:var(--text); font-family:'Space Mono',monospace; overflow:hidden; }

  #app { display:flex; flex-direction:column; height:100dvh; width:100vw; }

  header {
    display:flex; align-items:center; justify-content:space-between;
    padding:10px 16px; border-bottom:1px solid var(--border);
    flex-shrink:0; background:var(--bg); z-index:20;
  }
  .logo { font-family:'Bebas Neue',sans-serif; font-size:clamp(1.4rem,5vw,2rem); letter-spacing:0.08em; color:var(--accent); text-shadow:0 0 15px rgba(0,255,136,0.5); }
  .logo span { color:var(--accent2); }
  .status-pill { display:flex; align-items:center; gap:6px; background:var(--surface); border:1px solid var(--border); padding:6px 12px; border-radius:100px; font-size:0.65rem; letter-spacing:0.1em; text-transform:uppercase; }
  .dot { width:7px; height:7px; border-radius:50%; background:var(--muted); transition:all 0.3s; }
  .dot.active { background:var(--accent); box-shadow:0 0 6px var(--accent); animation:blink 1.5s infinite; }
  @keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.3} }

  .camera-wrap { position:relative; flex:1; overflow:hidden; background:#05050a; }

  #videoElement { width:100%; height:100%; object-fit:cover; transform:scaleX(-1); display:block; }
  #canvasOverlay { position:absolute; inset:0; width:100%; height:100%; transform:scaleX(-1); pointer-events:none; }

  .placeholder { position:absolute; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:12px; color:var(--muted); }
  .placeholder .big { font-size:clamp(3rem,15vw,5rem); }
  .placeholder p { font-size:0.75rem; text-align:center; max-width:220px; line-height:1.7; }

  #startBtn {
    position:absolute; inset:0; display:flex; align-items:center; justify-content:center;
    background:rgba(5,5,15,0.6); border:none; cursor:pointer; flex-direction:column; gap:12px; font-family:'Space Mono',monospace;
  }
  .start-ring {
    width:clamp(70px,20vw,90px); height:clamp(70px,20vw,90px); border-radius:50%;
    border:2px solid var(--accent); display:flex; align-items:center; justify-content:center;
    font-size:clamp(1.6rem,8vw,2.2rem);
    animation:gpulse 2s infinite;
  }
  @keyframes gpulse {
    0%,100% { box-shadow:0 0 20px rgba(0,255,136,0.3),inset 0 0 20px rgba(0,255,136,0.05); }
    50% { box-shadow:0 0 40px rgba(0,255,136,0.6),inset 0 0 30px rgba(0,255,136,0.1); }
  }
  .start-label { font-size:0.7rem; letter-spacing:0.15em; color:var(--accent); text-transform:uppercase; }

  #stopBtn { position:absolute; top:10px; left:10px; background:rgba(0,0,0,0.7); border:1px solid var(--accent2); color:var(--accent2); font-family:'Space Mono',monospace; font-size:0.6rem; letter-spacing:0.1em; text-transform:uppercase; padding:6px 12px; border-radius:6px; cursor:pointer; display:none; }
  .fps-tag { position:absolute; top:10px; right:10px; background:rgba(0,0,0,0.6); border:1px solid var(--border); border-radius:6px; padding:4px 8px; font-size:0.6rem; color:var(--accent); letter-spacing:0.1em; display:none; }

  .gesture-badge { position:absolute; bottom:12px; left:50%; transform:translateX(-50%); background:rgba(5,5,15,0.88); border:1.5px solid var(--accent); border-radius:16px; padding:10px 24px; text-align:center; backdrop-filter:blur(12px); min-width:180px; box-shadow:0 0 20px rgba(0,255,136,0.25); display:none; }
  .badge-emoji { font-size:clamp(1.8rem,7vw,2.5rem); display:block; line-height:1; }
  .badge-name { font-family:'Bebas Neue',sans-serif; font-size:clamp(1.3rem,5vw,1.8rem); color:var(--accent); letter-spacing:0.1em; line-height:1.1; }
  .conf-bar { width:100%; height:3px; background:var(--border); border-radius:2px; margin-top:6px; overflow:hidden; }
  .conf-fill { height:100%; background:var(--accent); border-radius:2px; transition:width 0.15s; box-shadow:0 0 5px var(--accent); }

  .bottom-panel { flex-shrink:0; background:var(--surface); border-top:1px solid var(--border); max-height:38vh; display:flex; flex-direction:column; }
  .tabs { display:flex; border-bottom:1px solid var(--border); flex-shrink:0; }
  .tab { flex:1; padding:10px 4px; font-size:0.6rem; letter-spacing:0.1em; text-transform:uppercase; color:var(--muted); text-align:center; cursor:pointer; border-bottom:2px solid transparent; transition:all 0.2s; }
  .tab.active { color:var(--accent); border-bottom-color:var(--accent); }
  .panel-body { flex:1; overflow-y:auto; padding:10px 14px; -webkit-overflow-scrolling:touch; }
  .panel-body::-webkit-scrollbar { display:none; }
  .pane { display:none; }
  .pane.active { display:block; }

  .chips { display:flex; flex-wrap:wrap; gap:6px; margin-bottom:8px; }
  .chip { display:flex; align-items:center; gap:5px; background:var(--bg); border:1px solid var(--border); border-radius:100px; padding:4px 10px; font-size:0.65rem; color:var(--muted); transition:all 0.2s; white-space:nowrap; }
  .chip.detected { border-color:var(--accent); color:var(--accent); background:rgba(0,255,136,0.08); box-shadow:0 0 8px rgba(0,255,136,0.15); }
  .chip-emoji { font-size:1rem; }
  .cat-label { font-size:0.58rem; letter-spacing:0.15em; text-transform:uppercase; color:var(--muted); margin:8px 0 5px; }
  .cat-label:first-child { margin-top:0; }

  .log-item { display:flex; align-items:center; gap:8px; padding:6px 0; border-bottom:1px solid var(--border); }
  .log-time { color:var(--muted); font-size:0.58rem; min-width:54px; }
  .log-em { font-size:1.1rem; }
  .log-n { font-size:0.72rem; }
  .log-c { margin-left:auto; color:var(--muted); font-size:0.6rem; }

  .stat-row { display:flex; justify-content:space-between; align-items:center; padding:8px 0; border-bottom:1px solid var(--border); }
  .stat-l { font-size:0.65rem; color:var(--muted); }
  .stat-v { font-size:0.9rem; color:var(--accent); }

  @keyframes flash { 0%{opacity:1} 50%{opacity:0.3} 100%{opacity:1} }
  .flash { animation:flash 0.15s; }
</style>
</head>
<body>
<div id="app">
  <header>
    <div class="logo">HAND<span>SPEAK</span></div>
    <div class="status-pill">
      <div class="dot" id="dot"></div>
      <span id="statusTxt">OFF</span>
    </div>
  </header>

  <div class="camera-wrap">
    <video id="videoElement" autoplay playsinline muted></video>
    <canvas id="canvasOverlay"></canvas>

    <div class="placeholder" id="placeholder">
      <div class="big">üñê</div>
      <p>Tap the button to start gesture detection</p>
    </div>

    <button id="startBtn" onclick="startCamera()">
      <div class="start-ring">üñê</div>
      <span class="start-label">Tap to Start</span>
    </button>

    <button id="stopBtn" onclick="stopCamera()">‚úï STOP</button>
    <div class="fps-tag" id="fpsTxt">-- FPS</div>

    <div class="gesture-badge" id="badge">
      <span class="badge-emoji" id="bEmoji">‚Äî</span>
      <div class="badge-name" id="bName">‚Äî</div>
      <div class="conf-bar"><div class="conf-fill" id="confFill" style="width:0%"></div></div>
    </div>
  </div>

  <div class="bottom-panel">
    <div class="tabs">
      <div class="tab active" onclick="switchPane('gestures',this)">Gestures</div>
      <div class="tab" onclick="switchPane('log',this)">Log</div>
      <div class="tab" onclick="switchPane('stats',this)">Stats</div>
    </div>
    <div class="panel-body">
      <div class="pane active" id="pane-gestures">
        <div class="cat-label">Numbers</div>
        <div class="chips" id="chips-numbers"></div>
        <div class="cat-label">Signs</div>
        <div class="chips" id="chips-signs"></div>
        <div class="cat-label">Expressions</div>
        <div class="chips" id="chips-expressions"></div>
      </div>
      <div class="pane" id="pane-log">
        <div id="logList"></div>
        <div style="text-align:center;padding:8px 0">
          <button onclick="document.getElementById('logList').innerHTML=''" style="background:none;border:1px solid var(--border);color:var(--muted);font-family:'Space Mono',monospace;font-size:0.6rem;padding:5px 14px;border-radius:6px;cursor:pointer;letter-spacing:0.1em;text-transform:uppercase">CLEAR</button>
        </div>
      </div>
      <div class="pane" id="pane-stats">
        <div class="stat-row"><span class="stat-l">Total Detections</span><span class="stat-v" id="sTot">0</span></div>
        <div class="stat-row"><span class="stat-l">Most Common</span><span class="stat-v" id="sCom">‚Äî</span></div>
        <div class="stat-row"><span class="stat-l">Avg Confidence</span><span class="stat-v" id="sConf">‚Äî</span></div>
        <div class="stat-row"><span class="stat-l">Unique Gestures</span><span class="stat-v" id="sUniq">0</span></div>
        <div class="stat-row"><span class="stat-l">Session Time</span><span class="stat-v" id="sTime">00:00</span></div>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands@0.4.1646424915/hands.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils@0.3.1675466862/camera_utils.js" crossorigin="anonymous"></script>
<script>
const CATS = {
  numbers:[
    {id:'zero',name:'Zero',emoji:'0Ô∏è‚É£'},{id:'one',name:'One',emoji:'1Ô∏è‚É£'},
    {id:'two',name:'Two',emoji:'2Ô∏è‚É£'},{id:'three',name:'Three',emoji:'3Ô∏è‚É£'},
    {id:'four',name:'Four',emoji:'4Ô∏è‚É£'},{id:'five',name:'Five',emoji:'5Ô∏è‚É£'},
  ],
  signs:[
    {id:'thumbsup',name:'Thumbs Up',emoji:'üëç'},{id:'thumbsdown',name:'Thumbs Down',emoji:'üëé'},
    {id:'peace',name:'Peace',emoji:'‚úåÔ∏è'},{id:'rock',name:'Rock On',emoji:'ü§ò'},
    {id:'ok',name:'OK Sign',emoji:'üëå'},{id:'stop',name:'Stop',emoji:'üõë'},
    {id:'point',name:'Point Up',emoji:'üëÜ'},{id:'call',name:'Call Me',emoji:'ü§ô'},
  ],
  expressions:[
    {id:'fist',name:'Fist',emoji:'‚úä'},{id:'openhand',name:'Open Hand',emoji:'üñê'},
    {id:'pinch',name:'Pinch',emoji:'ü§å'},{id:'gun',name:'Finger Gun',emoji:'ü´µ'},
    {id:'heart',name:'Crossed',emoji:'ü§û'},{id:'vulcan',name:'Vulcan',emoji:'üññ'},
  ]
};
const ALL=[...CATS.numbers,...CATS.signs,...CATS.expressions];
const byId={};
ALL.forEach(g=>byId[g.id]=g);
Object.entries(CATS).forEach(([cat,gs])=>{
  const wrap=document.getElementById('chips-'+cat);
  gs.forEach(g=>{
    const c=document.createElement('div');
    c.className='chip';c.id='chip-'+g.id;
    c.innerHTML=`<span class="chip-emoji">${g.emoji}</span>${g.name}`;
    wrap.appendChild(c);
  });
});

let running=false,hands=null,cam=null,lastId=null,prevChip=null;
let stats={tot:0,map:{},csum:0,start:null};
let fc=0,ft=0;

async function startCamera(){
  const video=document.getElementById('videoElement');
  const canvas=document.getElementById('canvasOverlay');

  hands=new Hands({locateFile:f=>`https://cdn.jsdelivr.net/npm/@mediapipe/hands@0.4.1646424915/${f}`});
  hands.setOptions({maxNumHands:2,modelComplexity:1,minDetectionConfidence:0.7,minTrackingConfidence:0.5});
  hands.onResults(onResults);

  const isMobile=/Mobi|Android|iPhone|iPad/i.test(navigator.userAgent);
  cam=new Camera(video,{
    onFrame:async()=>{
      if(hands) await hands.send({image:video});
      fc++;
      const now=performance.now();
      if(now-ft>1000){
        document.getElementById('fpsTxt').textContent=Math.round(fc*1000/(now-ft))+' FPS';
        ft=now;fc=0;
      }
    },
    width:1280,height:720,
    facingMode:isMobile?'environment':'user'
  });
  await cam.start();

  video.addEventListener('loadeddata',()=>{canvas.width=video.videoWidth;canvas.height=video.videoHeight;},{once:true});

  running=true;
  document.getElementById('placeholder').style.display='none';
  document.getElementById('startBtn').style.display='none';
  document.getElementById('stopBtn').style.display='block';
  document.getElementById('badge').style.display='block';
  document.getElementById('fpsTxt').style.display='block';
  document.getElementById('dot').classList.add('active');
  document.getElementById('statusTxt').textContent='LIVE';
  stats.start=Date.now();
  tickTimer();
}

function stopCamera(){
  if(cam){cam.stop();cam=null;}
  if(hands){hands.close();hands=null;}
  running=false;
  const canvas=document.getElementById('canvasOverlay');
  canvas.getContext('2d').clearRect(0,0,canvas.width,canvas.height);
  document.getElementById('placeholder').style.display='flex';
  document.getElementById('startBtn').style.display='flex';
  document.getElementById('stopBtn').style.display='none';
  document.getElementById('badge').style.display='none';
  document.getElementById('fpsTxt').style.display='none';
  document.getElementById('dot').classList.remove('active');
  document.getElementById('statusTxt').textContent='OFF';
  if(prevChip){document.getElementById('chip-'+prevChip)?.classList.remove('detected');prevChip=null;}
}

const BONES=[[0,1],[1,2],[2,3],[3,4],[0,5],[5,6],[6,7],[7,8],[5,9],[9,10],[10,11],[11,12],[9,13],[13,14],[14,15],[15,16],[13,17],[0,17],[17,18],[18,19],[19,20]];

function onResults(results){
  const video=document.getElementById('videoElement');
  const canvas=document.getElementById('canvasOverlay');
  canvas.width=video.videoWidth||canvas.width;
  canvas.height=video.videoHeight||canvas.height;
  const ctx=canvas.getContext('2d');
  ctx.clearRect(0,0,canvas.width,canvas.height);
  let best=null;
  if(results.multiHandLandmarks?.length){
    for(const lm of results.multiHandLandmarks){
      drawHand(ctx,lm,canvas.width,canvas.height);
      const g=classify(lm);
      if(g&&(!best||g.conf>best.conf))best=g;
    }
  }
  showGesture(best);
}

function drawHand(ctx,lm,w,h){
  ctx.lineWidth=2.5;
  BONES.forEach(([a,b])=>{
    ctx.beginPath();ctx.strokeStyle='rgba(0,255,136,0.55)';
    ctx.moveTo(lm[a].x*w,lm[a].y*h);ctx.lineTo(lm[b].x*w,lm[b].y*h);ctx.stroke();
  });
  lm.forEach((p,i)=>{
    const thumb=i>=1&&i<=4;
    ctx.beginPath();ctx.fillStyle=thumb?'#ff3366':'#00ff88';
    ctx.shadowColor=thumb?'#ff3366':'#00ff88';ctx.shadowBlur=8;
    ctx.arc(p.x*w,p.y*h,i===0?6:3.5,0,Math.PI*2);ctx.fill();ctx.shadowBlur=0;
  });
}

function d(lm,a,b){return Math.hypot(lm[a].x-lm[b].x,lm[a].y-lm[b].y);}

function fingerExt(lm){
  const tips=[4,8,12,16,20],pips=[3,6,10,14,18],ext=[];
  const right=lm[4].x>lm[17].x;
  ext[0]=right?lm[4].x>lm[2].x+0.02:lm[4].x<lm[2].x-0.02;
  for(let i=1;i<5;i++)ext[i]=lm[tips[i]].y<lm[pips[i]].y-0.02;
  return ext;
}

function classify(lm){
  const [T,I,M,R,P]=fingerExt(lm);
  if(!T&&!I&&!M&&!R&&!P) return{id:'fist',conf:0.95};
  if(T&&I&&M&&R&&P){const gap=Math.abs(lm[12].x-lm[16].x);return gap>0.06?{id:'vulcan',conf:0.87}:{id:'stop',conf:0.88};}
  if(!T&&I&&M&&R&&P) return{id:'four',conf:0.91};
  if(!T&&I&&M&&R&&!P) return{id:'three',conf:0.90};
  if(!T&&I&&M&&!R&&!P){const cross=Math.abs(lm[8].x-lm[12].x)<0.035;return cross?{id:'heart',conf:0.84}:{id:'peace',conf:0.93};}
  if(!T&&I&&!M&&!R&&!P) return{id:'one',conf:0.93};
  if(!T&&I&&!M&&!R&&P) return{id:'rock',conf:0.92};
  if(T&&!I&&!M&&!R&&P) return{id:'call',conf:0.91};
  if(T&&I&&!M&&!R&&!P) return{id:'gun',conf:0.87};
  if(T&&!I&&!M&&!R&&!P) return lm[4].y<lm[3].y?{id:'thumbsup',conf:0.92}:{id:'thumbsdown',conf:0.90};
  if(d(lm,4,8)<0.06&&M&&R&&P) return{id:'ok',conf:0.89};
  if(d(lm,4,8)<0.06&&!M&&!R&&!P) return{id:'zero',conf:0.87};
  if(T&&I&&M&&R&&P) return{id:'five',conf:0.88};
  return null;
}

function showGesture(detected){
  const badge=document.getElementById('badge');
  if(detected){
    const g=byId[detected.id];if(!g)return;
    document.getElementById('bName').textContent=g.name.toUpperCase();
    document.getElementById('bEmoji').textContent=g.emoji;
    document.getElementById('confFill').style.width=(detected.conf*100)+'%';
    if(prevChip&&prevChip!==detected.id)document.getElementById('chip-'+prevChip)?.classList.remove('detected');
    document.getElementById('chip-'+detected.id)?.classList.add('detected');
    prevChip=detected.id;
    if(detected.id!==lastId){
      badge.classList.add('flash');setTimeout(()=>badge.classList.remove('flash'),150);
      addLog(g,detected.conf);updateStats(g,detected.conf);lastId=detected.id;
    }
  } else {
    document.getElementById('bName').textContent='NO HAND';
    document.getElementById('bEmoji').textContent='‚Äî';
    document.getElementById('confFill').style.width='0%';
    lastId=null;
    if(prevChip){document.getElementById('chip-'+prevChip)?.classList.remove('detected');prevChip=null;}
  }
}

function addLog(g,conf){
  const t=new Date().toLocaleTimeString('en',{hour12:false,hour:'2-digit',minute:'2-digit',second:'2-digit'});
  const el=document.createElement('div');el.className='log-item';
  el.innerHTML=`<span class="log-time">${t}</span><span class="log-em">${g.emoji}</span><span class="log-n">${g.name}</span><span class="log-c">${Math.round(conf*100)}%</span>`;
  const list=document.getElementById('logList');
  list.insertBefore(el,list.firstChild);
  while(list.children.length>60)list.removeChild(list.lastChild);
}

function updateStats(g,conf){
  stats.tot++;stats.csum+=conf;stats.map[g.id]=(stats.map[g.id]||0)+1;
  document.getElementById('sTot').textContent=stats.tot;
  const top=Object.entries(stats.map).sort((a,b)=>b[1]-a[1])[0];
  if(top){const tg=byId[top[0]];document.getElementById('sCom').textContent=tg.emoji+' '+tg.name;}
  document.getElementById('sConf').textContent=Math.round(stats.csum/stats.tot*100)+'%';
  document.getElementById('sUniq').textContent=Object.keys(stats.map).length;
}

function tickTimer(){
  if(!stats.start)return;
  const e=Math.floor((Date.now()-stats.start)/1000);
  document.getElementById('sTime').textContent=String(Math.floor(e/60)).padStart(2,'0')+':'+String(e%60).padStart(2,'0');
  setTimeout(tickTimer,1000);
}

function switchPane(name,el){
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.pane').forEach(p=>p.classList.remove('active'));
  el.classList.add('active');
  document.getElementById('pane-'+name).classList.add('active');
}
</script>
</body>
</html>
